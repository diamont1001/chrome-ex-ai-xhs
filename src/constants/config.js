/**
 * é…ç½®ç›¸å…³å¸¸é‡
 */

// äººè®¾é¢„è®¾å€¼
export const PRESET_AI_PERSONA = [
  {
    name: 'é€šç”¨äººè®¾',
    value: [
      'ä½ æ˜¯ä¸€ä¸ªç¤¾äº¤åª’ä½“åŠ©æ‰‹ï¼Œæ“…é•¿ä¸ºå°çº¢ä¹¦å¸–å­ç”Ÿæˆæœ‰ä»·å€¼çš„è¯„è®ºã€‚',
      'ä½ çš„ä»»åŠ¡æ˜¯ç”Ÿæˆå‹å¥½ã€çœŸå®ã€æœ‰è¶£ã€èƒ½å¼•èµ·å…±é¸£çš„è¯„è®ºï¼Œä»¥å¢å¼ºå¸–å­çš„äº’åŠ¨æ€§ã€‚è¯·éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š',
      'Â·è¯­è¨€é£æ ¼: å£è¯­åŒ–ã€å¸¦ç‚¹å¹½é»˜ï¼Œç¬¦åˆå°çº¢ä¹¦ç¤¾åŒºé£æ ¼ï¼Œå¯é€‚å½“ä½¿ç”¨è¡¨æƒ…åŒ…ï¼ˆå¦‚ğŸ’¡ğŸ‘ï¼‰',
      'Â·ç¦æ­¢è¡Œä¸º:',
      '  - ä¸ç¼–é€ è™šå‡ä¿¡æ¯',
      '  - ä¸å¸¦#è¯é¢˜æ ‡ç­¾',
      '  - è¯„è®ºè¦è‡ªç„¶ï¼Œä¸è¦è¿‡å¤šé€éœ²å‡ºåšå¹¿å‘Šçš„å«Œç–‘',
      'Â·æ ¼å¼: çº¯æ–‡æœ¬ï¼Œä»…åŒ…å«æˆ‘å¯ä»¥ç”¨æ¥ç›´æ¥è¯„è®ºçš„å®Œæ•´å†…å®¹',
      'Â·é•¿åº¦: 20-50å­—ä¸ºå®œï¼Œç®€æ´æœ‰åŠ›ï¼Œä¸è¶…è¿‡144ä¸ªå­—',
    ].join('\n'),
  },
  {
    name: 'äºŒæ‰‹è½¦æ‡‚è½¦å¦¹',
    value: [
      'ä½ æ˜¯ä¸€ä¸ªå°çº¢ä¹¦é£æ ¼çš„äºŒæ‰‹è½¦è¯„è®ºåŠ©æ‰‹ï¼Œæ“…é•¿ä¸ºå°çº¢ä¹¦å¸–å­ç”Ÿæˆæœ‰ä»·å€¼çš„è¯„è®ºã€‚',
      'ä½ çš„ä»»åŠ¡æ˜¯ç”Ÿæˆå‹å¥½ã€çœŸå®ã€æ˜“æ‡‚çš„è¯„è®ºï¼Œå¸®åŠ©ç”¨æˆ·äº†è§£äºŒæ‰‹è½¦å¸‚åœºã€‚è¯·éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š',
      'Â·è¯­è¨€é£æ ¼: å£è¯­åŒ–ã€å¸¦ç‚¹å¹½é»˜ï¼Œç¬¦åˆå°çº¢ä¹¦ç¤¾åŒºé£æ ¼ï¼Œå¯é€‚å½“ä½¿ç”¨è¡¨æƒ…åŒ…ï¼ˆå¦‚ğŸš—ğŸ’¡ğŸ‘ï¼‰',
      'Â·å†…å®¹æ–¹å‘:',
      '  - æŒ‡å‡ºè½¦è¾†ä¼˜ç¼ºç‚¹ï¼ˆå¦‚â€œè¿™è½¦çœæ²¹ï¼Œä½†åæ’ç©ºé—´å°ï¼Œé€‚åˆå•èº«æˆ–å°ä¸¤å£â€ï¼‰',
      '  - æä¾›ç ä»·å»ºè®®ï¼ˆå¦‚â€œè¿™è½¦æŒ‚ç‰Œä»·åé«˜ï¼Œå»ºè®®ç…§ç€8æŠ˜ç â€ï¼‰',
      '  - æé†’é¿å‘ç‚¹ï¼ˆå¦‚â€œä¸€å®šè¦æŸ¥ç»´ä¿è®°å½•ï¼Œé¿å…äº‹æ•…è½¦ï¼â€ï¼‰',
      'Â·ç¦æ­¢è¡Œä¸º:',
      '  - ä¸ç¼–é€ è™šå‡ä¿¡æ¯',
      '  - ä¸å¸¦#è¯é¢˜æ ‡ç­¾',
      '  - ä¸æ¨èå…·ä½“è½¦å•†ï¼ˆä¿æŒä¸­ç«‹ï¼‰',
      'Â·æ ¼å¼: çº¯æ–‡æœ¬ï¼Œä»…åŒ…å«æˆ‘å¯ä»¥ç”¨æ¥ç›´æ¥è¯„è®ºçš„å®Œæ•´å†…å®¹',
      'Â·é•¿åº¦: 20-50å­—ä¸ºå®œï¼Œç®€æ´æœ‰åŠ›ï¼Œä¸è¶…è¿‡144ä¸ªå­—',
    ].join('\n'),
  },
];

// é»˜è®¤é…ç½®
export const DEFAULT_CONFIG = {
  aiPersona: PRESET_AI_PERSONA[0].value,
  models: [
    {
      name: 'GPT-4o',
      value: 'gpt-4o',
      apiKey: '',
      url: 'https://api.openai.com/v1/chat/completions',
      isSelected: false,
    },
    {
      name: 'é˜¿é‡Œåƒé—®',
      value: 'qwen-vl-plus',
      apiKey: '',
      url: 'https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions',
      isSelected: false,
    },
  ],
  filterEnabled: false,
  minComments: 100,
};

// é…ç½®key
export const CONFIG_KEY = 'xhs-comment-assistant-config';

// è·å–å½“å‰é…ç½®
export async function getConfig() {
  return new Promise(resolve => {
    chrome.storage.sync.get([CONFIG_KEY], function (result) {
      resolve(result[CONFIG_KEY] || DEFAULT_CONFIG);
    });
  });
}

// ä¿å­˜é…ç½®
export async function saveConfig(config) {
  return new Promise(resolve => {
    chrome.storage.sync.set({ [CONFIG_KEY]: config }, function () {
      resolve();
    });
  });
}

// é‡ç½®é…ç½®
export async function resetConfig() {
  return new Promise(resolve => {
    chrome.storage.sync.set({ [CONFIG_KEY]: DEFAULT_CONFIG }, function () {
      resolve();
    });
  });
}

// å–ä¸€ä¸ªå¯ç”¨æ¨¡å‹
export async function getAvailableModel() {
  try {
    const { models } = await getConfig();
    const arr = models.filter(item => item.isSelected);
    // éšæœºè¿”å›ä¸€ä¸ªç”¨æ¨¡å‹
    return arr[Math.floor(Math.random() * arr.length)];
  } catch (error) {
    console.error('[getAvailableModel]error', error);
    return Promise.reject(new Error('æ²¡æœ‰å¯ç”¨æ¨¡å‹'));
  }
}
